---
title: "Artisanal Democracy Data: A Quick and Easy Way of Extending the Unified Democracy Scores"
output: 
  html_document: 
    keep_md: yes
    self_contained: no
---

```{r, include=FALSE}
library(knitr)
library(ggplot2)
library(scales)
library(QuickUDS)
library(dplyr)
opts_chunk$set(message=FALSE, 
               warning=FALSE,
               echo=FALSE,
               # cache.rebuild = TRUE,
               cache=TRUE)
```

(Of interest primarily to people interested in measuring democracy in the 19th century, or creating latent variable indexes of democracy for fun. Contains a small amount of code.)

If you have followed the [graphics-heavy posts in this blog](http://abandonedfootnotes.blogspot.co.nz/search/label/visualizations), you may have noticed that I really like the [Unified Democracy Scores](http://www.unified-democracy-scores.org/) developed by [Daniel Pemstein](http://www.danpemstein.com/), [Stephen Meserve](https://sites.google.com/site/stephenmeserve2/), and [James Melton](http://www.ucl.ac.uk/~uctqjm0/). The basic idea behind this particular measure of democracy, [as they explain in their 2010 article](http://pan.oxfordjournals.org/content/early/2010/08/26/pan.mpq020.full.html?ijkey=3BdlpJbUIjswu7q&keytype=ref), is as follows. We have a wealth of measures of democracy (some large-scale projects like the [Polity dataset](http://www.systemicpeace.org/inscrdata.html) or the [Freedom in the World](https://freedomhouse.org/report-types/freedom-world) index, some small "boutique" efforts by political scientists developed for a particular research project). Though these measures are typically highly correlated (usually on the 0.8-0.9 range), they still differ significantly for some countries and years, differences that are both conceptual (researchers disagree about the essential characteristics of democracy) and empirical (researchers disagree about whether a given country-year is democratic according to a particular definition). PMM argue that we can thus assume that these measures are all getting at a latent trait that is only imperfectly observed and conceptualized by the compilers of all the datasets purporting to measure democracy, and that we can estimate this trait using techniques from [item response theory](https://en.wikipedia.org/wiki/Item_response_theory) that were originally developed to evaluate the performance of multiple graders in academic settings. 

PMM then proceeded to do just that, producing a dataset that not only contains latent variable estimates of democracy for `r nrow(uds_2014)` country-years (`r length(unique(uds_2014$country_name))` unique countries), but also contains estimates of the measurement error associated with these scores (derived from the patterns of disagreement between different democracy measures). This, to be honest, is one of the main attractions of the UDS for me: I get nervous when I see a measure of democracy that does not have a confidence interval around it, given the empirical and conceptual difficulties involved in producing such numerical estimates of a wooly concept like "democracy." Nevertheless, the UDS had some limitations: for one thing, they only went back to `r min(uds_2014$year)`, even though many existing measures of democracy contain information for earlier periods, and PMM never made use of all the publicly available measures of democracy in the construction of the UDS, which meant that the standard errors around the scores were relatively large. (The original UDS used 10 different democracy measures for its construction; the current release uses 12,[[^Measures]] but I count more than 25). 

Moreover, the UDS haven't been updated since 2014 (and then only to `r max(uds_2014$year)`), and PMM seem to have moved on from the project. Pemstein, for example, is now involved with measurement at the [V-Dem institute](https://www.v-dem.net/en/), whose "Varieties of Democracy" dataset promises to be the gold standard for democracy measurement, so I'm guessing the UDS will not receive many more updates, if any. (If you are engaged in serious empirical research on democracy, you should probably be using the V-dem dataset anyway. Seriously, it's amazing - I may write a post about it later this year). And though in principle one could use their software to update these scores, and PMM even made available an (undocumented) [replication package in 2013](http://hdl.handle.net/1902.1/PMM), I was never able to make it work properly, and their Bayesian algorithms for estimating the latent trait seemed anyway too computationally intensive for my time and budget. 

I think this situation is a pity. For many of my own purposes -- which have to do mostly with the history of political regimes for my current project -- I'd like a measure that aggregates both empirical and conceptual uncertainty about democracy in a principled way for a very large number of countries, just like I believe the UDS did. But I also would like a measure that goes back as far as possible in time, and I'd like to be able to easily reconstruct the latent index using new information (e.g., new releases of the underlying measures). The new V-dem indexes are great on one of these counts (they come with confidence intervals) but not on others (they only go back to 1900, they are missing some countries, and the full dataset is a bit unwieldy -- too many choices distract me). Other datasets -- the trusty [Polity ](http://www.systemicpeace.org/inscrdata.html), the new and excellent [LIED index](http://ps.au.dk/en/research/research-projects/dedere/datasets/) -- do go back to the 19th century, but they have no estimates of measurement uncertainty, and they make specific choices about conceptualization that I do not always agree with (and which would be incorporated into measurement and conceptual uncertainty in a UDS-style measure). 

But why wait for others to do this when I can do it myself? So I went ahead and figured out how to first replicate the Unified Democracy scores without using a computationally intensive Bayesian algorithm, and then extended them both forwards to 2015 and backwards to the 19th century (in some cases tot he 18th century), using information from 28 different measures of democracy (some of them rather obscure, some just new, like the [LIED index](http://ps.au.dk/en/research/research-projects/dedere/datasets/) or the latest version of the Freedom House data). And I created an [R package](https://github.com/xmarquez/QuickUDS) to let you do the same, should you wish to fiddle with the details or create your own version of the UDS. (Democratizing democracy indexes since 2016!). The gory details are all in [this paper](http://papers.ssrn.com/abstract=2753830), which explains how to replicate and extend the scores, and contains plenty of diagnostic pictures of the result; but if you only want to see the code to produce the extended UDS scores check out [the package vignette here](https://github.com/xmarquez/QuickUDS/). If you are an R user, you can easily install the package and its documentation by typing (assuming you have [devtools](https://cran.r-project.org/web/packages/devtools/index.html) installed, and that I've done everything correctly on my side):

```{r, echo=TRUE, eval=FALSE}
devtools::install_github(repo = "https://github.com/xmarquez/QuickUDS")

```

The package includes both my "extended" UDS measure (fully documented and covering `r nrow(extended_uds)` country-years going all the way to the 18th century in some cases, for `r length(unique(extended_uds$country_name))` sovereign countries and some non-sovereign territories) and a replication dataset which includes 61 different measures of democracy from 29 different measurement efforts covering a total of `r nrow(democracy)` country-years (also fully documented). (Even if you are not interested in the UDS, original or extended, you may be interested in that dataset of democracy scores). For those poor benighted souls who use Stata or (God fobid) some awful thing like SPSS (kidding!), you can access a CSV version of the package datasets and a PDF version of their documentation [here](https://github.com/xmarquez/QuickUDS/tree/master/csvs-and-pdfs). 

To be sure, for most research projects you probably don't need this extended Unified Democracy measure. After all, most useful variables used in your typical democracy regression are unmeasured or unavailable before the 1950s for most countries, and if your work only requires measures of democracy going back to the 1900, you are better off with the new V-dem data, for example, rather than this artisanal version of the UDS. But the extended UDS is nice for some things, I think.

First, quantitative history. For example, consider the problem of measuring democracy in the USA over the entirety of the last two centuries. Existing democracy measures disagree about when the USA first became fully democratic, primarily because they disagree about how much to weigh formal restrictions on women's suffrage and the formal and informal disenfranchisement of African Americans in their conceptualization. Some measures give the USA the highest possible score early in the 19th century, others after the civil war, others only after 1920, with the introduction of women's suffrage, and yet others (e.g. LIED) not until 1965, after the Civil Rights Movement. With the extended UDS these differences do not matter very much: as consensus among the different datasets increases, so does the measured US level of democracy:

```{r}

data <- extended_uds %>% mutate(adj.z1 = z1 -0.68, 
                                        adj.pct025 = pct025 - 0.68, 
                                        adj.pct975 = pct975 - 0.68,
                                        index = pnorm(adj.z1),
                                        index.pct025 = pnorm(adj.pct025),
                                        index.pct975 = pnorm(adj.pct975))

countries <- c("United States of America")


data <- data %>% arrange(country_name,year) %>% group_by(country_name) %>% mutate(group = PoliticalDatasets::count_sequence_breaks(year)) %>% ungroup() 

labels <- data.frame(year = c(1828,1871,1920,1954), labels = c("Age of Jackson","Post Civil War era", "Women's suffrage", "Civil rights movement"))

data <- left_join(data,labels)
ggplot(data %>% filter(country_name %in% countries), aes(x=year,y=index,ymin = index.pct025,ymax = index.pct975, group= group, label=labels)) + 
  geom_path() + 
  geom_ribbon(alpha=0.2) + 
  theme_bw() + 
  labs(x = "Year", y = "Extended unified democracy score,\ntransformed to 0-1 probability scale, per year",color="")  + 
  theme(legend.position="bottom") + 
  guides(color = guide_legend(ncol=1),fill = guide_legend(nrow=1)) + 
  facet_wrap(~country_name,ncol=2) +
  geom_hline(yintercept = 0.5, color="red") +
  geom_text(angle=90) 
```

In the figure above, I use a transformed version of the extended UDS scores whose midpoint is the "consensus" estimate of the cutoff between democracy and non-democracy among minimalist, dichotomous measures in the latent variable scale. (For details, see [my paper](http://papers.ssrn.com/abstract=2753830); the grey areas represent 95% confidence intervals). This version can be interpreted as a probability scale: "1" means the country-year is almost certainly a democracy, "0" means it is almost certainly not a democracy, and "0.5" that it could be either. (Or we could arbitrarily decide that 0-0.33 means the country is likely an autocracy of whatever kind, 0.33-0.66 that it is likely some kind of hybrid regime, and 0.66-1 that is pretty much a democracy, at least by current scholarly standards). In any case, the extended UDS shows an increase in the USA's level of democracy in the 1820s (the "Age of Jackson"), the 1870s (after the civil war), the 1920s after female enfranchisement, and a gradual increase in the 1960s after the Civil Rights movement, though the magnitude of each increase (and of the standard error of the resulting score) depends on exactly which measures are used to construct the index. (The spike in the 2000s is an artifact of measurement, having more to do with the fact that lots of datasets end around that time than with any genuine spike in the USA's democracy score).

Just because what use is this blog if I cannot have a huge visualization, here are ALL THE DEMOCRACY SCORES, alphabetically by country (grey shaded areas represent 95% confidence intervals; blue shaded areas are periods where the country is either deemed to be a member of the system of states in the [Gleditsch and Ward list of statte system membership since 1816](http://privatewww.essex.ac.uk/~ksg/statelist.html), i.e., independent, or is a [microstate in Gleditsch's tentative list](http://privatewww.essex.ac.uk/~ksg/statelist.html)):

```{r, fig.height=30}

countries <- unique(data$country_name)

periods_of_independence <- data %>% group_by(country_name,group3,in_system) %>% summarise(start = min(year), end = max(year)) %>% filter(in_system)

ggplot() + 
  geom_path(data =data %>% filter(country_name %in% countries[1:112]), aes(x=year,y=index,ymin = index.pct025,ymax = index.pct975, group= group)) + 
  geom_ribbon(data = data %>% filter(country_name %in% countries[1:112]), aes(x=year,y=index,ymin = index.pct025,ymax = index.pct975, group= group), alpha=0.2) + 
  theme_bw() + 
  labs(x = "Year", y = "Extended unified democracy score,\ntransformed to 0-1 probability scale, per year",color="")  + 
  theme(legend.position="bottom") + 
  guides(color = guide_legend(ncol=1),fill = guide_legend(nrow=1)) + 
  facet_wrap(~country_name,ncol=4) +
  geom_hline(yintercept = 0.5, color="red") +
  geom_rect(data = periods_of_independence %>% filter(country_name %in% countries[1:112]), aes(xmin = start, xmax = end, ymin = 0, ymax = 1), alpha = 0.2, fill = "blue")

ggplot() + 
  geom_path(data =data %>% filter(country_name %in% countries[113:224]), aes(x=year,y=index,ymin = index.pct025,ymax = index.pct975, group= group)) + 
  geom_ribbon(data =data %>% filter(country_name %in% countries[113:224]), aes(x=year,y=index,ymin = index.pct025,ymax = index.pct975, group= group), alpha=0.2) + 
  theme_bw() + 
  labs(x = "Year", y = "Extended unified democracy score,\ntransformed to 0-1 probability scale, per year",color="")  + 
  theme(legend.position="bottom") + 
  guides(color = guide_legend(ncol=1),fill = guide_legend(nrow=1)) + 
  facet_wrap(~country_name,ncol=4) +
  geom_hline(yintercept = 0.5, color="red") +
  geom_rect(data = periods_of_independence %>% filter(country_name %in% countries[113:224]), aes(xmin = start, xmax = end, ymin = 0, ymax = 1), alpha = 0.2, fill = "blue")
```

A couple of things to note. First, scores are sometimes calculated for some countries for periods when they are not generally considered to be independent; this is because some of the underlying data used to produce them (e.g., the V-Dem dataset) produce measures of democracy for existing states before they became independent -- basically measuring how "open" their politics were under imperial governance (see, e.g., the graphs for India or South Korea). Second, confidence intervals vary quite a bit, primarily due to the number of measures of democracy available for particular country-years and the degree of their agreement. For some countries, the range of possibilities is so large (because too few datasets bother to produce a measure for a period, or the ones that do disagree radically) that the extended UD score is meaningless, but for most country-years (as I explain in my paper [my paper](http://papers.ssrn.com/abstract=2753830)) its standard error is actually much smaller than the standard error of the "official" UDS, making the measure more useful for empirical research. But in general the scores tend to capture intuitive movements (which is unsurprising, since they are based on all existing measures of democracy); see the graphs for Chile or Venezuela, for example. And using these scores we can get a better sense of the magnitude of the historical shifts towards democracy in the last two centuries.

For example, according to the extended UDS (and ignoring measurement uncertainty, just because this is a blog), a good 50% of the world's population today lives in countries that can be considered basically democratic, but only around 10% live in countries with the highest scores (0.8 and above):

```{r, fig.height=7}
data <- extended_uds %>% mutate(adj.z1 = z1 -0.68, 
                                        adj.pct025 = pct025 - 0.68, 
                                        adj.pct975 = pct975 - 0.68,
                                        index = pnorm(adj.z1),
                                        index.pct025 = pnorm(adj.pct025),
                                        index.pct975 = pnorm(adj.pct975))

data <- left_join(data,PoliticalDatasets::population.data)

data <- data %>% mutate(prop = pop/world.population.spline.interpolated)

data <- data %>% mutate(regime = cut(index, c(0,0.2,0.4,0.6,0.8,1), include.lowest=TRUE)) 

ggplot(data = data %>% filter(year > 1815),  aes(x=year, fill=regime,weight=prop)) + 
  geom_bar() + 
  theme_bw()+ 
  theme(legend.position="bottom") +
  labs(fill="Democracy level (0-1 probability scale, \n0.5 = average cutoff of dichotomous measures)", x="Year", y= "Proportion of the world's population\nin independent states")+
  guides(fill=guide_legend(ncol=2,title.position="top"))+
  scale_y_continuous(label=scales::percent) +
  scale_fill_brewer(type="div",palette="RdBu")
```

And [Huntington's three waves](https://en.wikipedia.org/wiki/Third_Wave_Democracy) of democratization seem clearly visible in the data (again ignoring measurement uncertainty):

```{r}
data <- data %>% 
  group_by(country_name) %>% 
  mutate(change = index - lag(index)) %>% 
  group_by(year) %>% 
  summarise(total_trans = sum(change,na.rm=TRUE)) %>% 
  ungroup() %>% 
  mutate(cumulative_trans = cumsum(total_trans))

ypos <- mean(c(-1,max(data$cumulative_trans)))
ggplot(data=data) +
  geom_rect(aes(xmin=1828,xmax=1926,ymin=min(cumulative_trans,na.rm=TRUE)-1,ymax=max(cumulative_trans,na.rm=TRUE)+1),alpha=0.02,fill="lightgrey")+
  geom_rect(aes(xmin=1943,xmax=1962,ymin=min(cumulative_trans,na.rm=TRUE)-1,ymax=max(cumulative_trans, na.rm=TRUE)+1),alpha=0.02,fill="lightgrey")+
  geom_rect(aes(xmin=1974,xmax=2008,ymin=min(cumulative_trans,na.rm=TRUE)-1,ymax=max(cumulative_trans,na.rm=TRUE)+1),alpha=0.02,fill="lightgrey")+
  geom_path(aes(x=year,y=cumulative_trans)) + 
  theme_bw()+
  scale_fill_grey()+
  labs(y="Cumulative changes in the \nlevel of democracy across countries")+
  annotate(geom="text",x=c(1850,1950,1990),y=c(ypos,ypos,ypos),label=c("First wave","Second wave","Third wave"),angle=90)+
  coord_cartesian(xlim=c(1800,2010),ylim=c(-1,max(data$cumulative_trans)))
```

But suppose you are not into quantitative history. There are, nevertheless, a couple of use cases where long-run, quantitative data about democracy with estimates of uncertainty is likely to be useful. Consider, for example, the question of the democratic peace, or of the relationship between economic development and democracy -- two questions that benefit from very long-run measures of democracy, especially measures that can be easily updated, like this one. 

I may write more about this later, but here's what this dataset might tell us about the basic stylized fact of the "[democratic peace](https://en.wikipedia.org/wiki/Democratic_peace_theory)." Using the [revised list of interstate wars by Gleditsch](http://privatewww.essex.ac.uk/~ksg/expwar.html), we can quickly create a scatterplot of the mean extended UD score of each side in an interstate war, and calculate the 2-d density distribution of these scores while accounting for their measurement uncertainty:

```{r, fig.height=8}
data <- left_join(PoliticalDatasets::interstate_dyads_yearly, QuickUDS::extended_uds %>% rename(country_name.x = country_name, GWn.x = GWn, z1.x = z1, se.z1.x = se.z1) %>% select(country_name.x,GWn.x,year,z1.x,se.z1.x))

data <- left_join(data, QuickUDS::extended_uds %>% rename(country_name.y = country_name, GWn.y = GWn, z1.y = z1, se.z1.y = se.z1) %>% select(country_name.y,GWn.y,year,z1.y,se.z1.y))

data <- data %>% group_by(warname,country_name.x,GWn.x,year,z1.x,se.z1.x,country_name.y,GWn.y,year,z1.y,se.z1.y) %>% do(data.frame(z1.x.norm = rnorm(500,.$z1.x, .$se.z1.x),z1.y.norm = rnorm(500,.$z1.y, .$se.z1.y)))

data <- data %>% ungroup() %>% mutate(index.x = pnorm(z1.x - 0.68), index.y = pnorm(z1.y - 0.68), index.x.norm = pnorm(z1.x.norm- 0.68), index.y.norm = pnorm(z1.y.norm - 0.68), xmin = pnorm(z1.x - 0.68 - 1.96*se.z1.x), xmax = pnorm(z1.x - 0.68 + 1.96*se.z1.x), ymin = pnorm(z1.y - 0.68 - 1.96*se.z1.y), ymax = pnorm(z1.y - 0.68 + 1.96*se.z1.y))

library(ggalt)
library(ggrepel)

demowars <- data %>% filter(index.x > 0.6, index.y > 0.6) %>% distinct(warname,index.x,index.y)

demowars <- demowars %>% mutate(label = paste0(warname,": ",country_name.x," vs. ", country_name.y,", ",year))

ggplot() + 
  geom_rect(data = data %>% distinct(warname,index.x,index.y), aes(xmin=xmin, xmax = xmax, ymin = ymin, ymax = ymax), alpha=0.1, fill="blue") +
  stat_bkde2d(data = data, bandwidth=c(0.05,0.05),aes(x=index.x.norm, y=index.y.norm, alpha=..level..), geom="polygon") +
  geom_point(data = data %>% distinct(warname,index.x,index.y),  aes(x=index.x, y = index.y)) +
  theme_bw() +
  theme(legend.position="bottom") +
  labs(x="UD score of side A in war\n(0-1 probability scale, \n0.5 = average cutoff of dichotomous democracy measures)",y = "UD score of side B in war\n(0-1 probability scale\n0.5 = average cutoff of dichotomous democracy measures)", alpha = "Density") +
  geom_vline(xintercept=0.5,color="red") +
  geom_hline(yintercept=0.5,color="red") +
  geom_text_repel(data = demowars, aes(x=index.x,y=index.y, label = label), force = 3)+
  coord_cartesian(ylim = c(0,1))
```

The x- coordinate of each point is the mean extended UD score (in the 0-1 probability scale where 0.5 is the consensus cutoff between democracy and non-democracy in the most minimalistic measures) of side A in a war listed by Gleditsch; the y-coordinate is the mean extended UD score of side B; each blue square is the 95% "confidence rectangle" around these measures; the shaded blobs are the 2-d probability densities, accounting for measurement uncertainty in the scores. As we can see, the basic stylized fact of a dyadid democratic peace is plausible enough, even after accouting for measurement uncertainty, at least for countries which have a high probability of being democratic (0.8 and above). In particular, countries whose mean extended UD democracy score is over 0.8 (in the transformed 0-1 scale) have not fought one another, even after accounting for measurement uncertainty. (Though they have fought plenty of wars with other countries, as the plot indicates). But note that the dyadic democratic peace only holds perfectly if we set the cutoff "being a democracy" quite high (0.8 is in the top 10% of country-years in this large sample; few countries have *ever* been that democratic); as we go down to the 0.5 cutoff, exceptions accumulate (I've labeled some of them).

Anyway, I could go on; if you are interested in this "artisanal" democracy data (or in creating your own version of these scores), take a look at [the paper](http://papers.ssrn.com/abstract=2753830), and use [the package](https://github.com/xmarquez/QuickUDS) -- and let me know if it works!

(Code for this post is available [here](https://github.com/xmarquez/quick-and-dirty-democracy-scores). Some of it depends on a package I've created but not shared yet, so you may not be able to replicate it all.)
